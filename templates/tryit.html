<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>IZA HR Assistant - Try it Yourself</title>

<!-- Google Font: Source Sans Pro -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
<!-- Font Awesome -->
<link rel="stylesheet" href="{{ url_for('static', filename='plugins/fontawesome-free/css/all.min.css') }}">
<!-- overlayScrollbars -->
<link rel="stylesheet" href="{{ url_for('static', filename='plugins/overlayScrollbars/css/OverlayScrollbars.min.css') }}">
<!-- Theme style -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/adminlte.min.css') }}">
<!-- Loader style -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/loader.css') }}">

</head>
<body class="hold-transition sidebar-mini layout-fixed">
  <!-- Loader -->
<div class="loader-container">
    <div class="loader"></div>
</div>
<!-- Site wrapper -->
<div class="wrapper">
  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="{{ url_for('homepage') }}" class="nav-link">Home</a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="{{ url_for('doc') }}" class="nav-link">Documentação</a>
      </li>
    </ul>
  </nav>
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="{{ url_for('homepage') }}" class="brand-link">
      <img src="{{ url_for('static', filename='img/applogo2.png') }}" alt="AdminLTE Logo" style="margin-left:10%;opacity: .8;width: 180px;">
      <!-- <span class="brand-text font-weight-light">IZA RH</span> -->
    </a>
    <!-- Sidebar -->
    <div class="sidebar">
      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <!-- Add icons to the links using the .nav-icon class
               with font-awesome or any other icon font library -->
          <li class="nav-item">
            <a href="{{ url_for('homepage') }}" class="nav-link">
              <i class="nav-icon fas fa-th"></i>
              <p>
                Dashboard
              </p>
            </a>
          </li>
                      <li class="nav-item">
            <a href="{{ url_for('interview') }}" class="nav-link">
              <i class="nav-icon fas fa-id-card"></i>
              <p>
                Simulação Entrevista
              </p>
            </a>
          </li>
                    <li class="nav-item">
            <a href="{{ url_for('try_it_yourself') }}" class="nav-link">
              <i class="nav-icon fas fa-lightbulb"></i>
              <p>
                Try it yourself
              </p>
            </a>
          </li>
        </ul>
      </nav>
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <section class="content-header">
      <div class="container-fluid">
        <h1>Explore Vagas Abertas</h1>

        <div class="row mt-3">
          <div class="col-md-4">
            <select id="locationFilter" class="form-control">
              <option value="">Todas as localizações</option>
            </select>
          </div>
          <div class="col-md-4">
            <select id="tipoFilter" class="form-control">
              <option value="">Todos os tipos</option>
            </select>
          </div>
        </div>
      </div>
    </section>

    <section class="content">
      <div class="container-fluid">
        <table id="tabelaVagas" class="table table-bordered table-striped">
          <thead>
            <tr>
              <th>Título</th>
              <th>Cliente</th>
              <th>Local</th>
              <th>Tipo</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </div>
  <!-- /.content-wrapper -->

  <!-- MODAL DETALHES -->
<div class="modal fade" id="vagaModal" tabindex="-1" role="dialog" aria-labelledby="vagaModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Detalhes da Vaga</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p><strong>Título:</strong> <span id="det-titulo"></span></p>
        <p><strong>Cliente:</strong> <span id="det-cliente"></span></p>
        <p><strong>Local:</strong> <span id="det-local"></span></p>
        <p><strong>Tipo:</strong> <span id="det-tipo"></span></p>
        <p><strong>Objetivo:</strong> <span id="det-objetivo"></span></p>
        <p><strong>Atividades:</strong> <span id="det-atividades"></span></p>
        <p><strong>Competências:</strong> <span id="det-competencias"></span></p>
      </div>
    </div>
  </div>
</div>


  <footer class="main-footer">
    <div class="float-right d-none d-sm-block">
      <b>Version:</b> MVP
    </div>
    <strong>FIAP Datathon</strong> Fase 5 - 2025.
  </footer>

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->

<script src="{{ url_for('static', filename='plugins/jquery/jquery.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/bootstrap/js/bootstrap.bundle.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/adminlte.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatables/jquery.dataTables.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatables-bs4/js/dataTables.bootstrap4.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatables-responsive/js/dataTables.responsive.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatables-responsive/js/responsive.bootstrap4.min.js') }}"></script>
<!-- Loader JS -->
<script src="{{ url_for('static', filename='js/loader.js') }}"></script>

<script>
function abrirDetalhes(id) {
  fetch(`/api/vaga_detalhe/${id}`)
    .then(res => res.json())
    .then(v => {
      document.getElementById("det-titulo").innerText = v.titulo || "";
      document.getElementById("det-cliente").innerText = v.cliente || "";
      document.getElementById("det-local").innerText = `${v.cidade || ""}, ${v.estado || ""}, ${v.pais || ""}`;
      document.getElementById("det-tipo").innerText = v.tipo_contratacao || "";
      document.getElementById("det-objetivo").innerText = v.objetivo_vaga || "";
      document.getElementById("det-atividades").innerText = v.atividades || "";
      document.getElementById("det-competencias").innerText = v.competencias || "";
      $('#vagaModal').modal('show');
    });
}

$(async function () {
  const response = await fetch("/api/vagas_abertas");
  const data = await response.json();

  const table = $('#tabelaVagas').DataTable({
data: data.map(v => [
  v.titulo,
  v.cliente,
  v.local,
  v.tipo,
  `<button class='btn btn-info btn-sm' onclick='abrirDetalhes("${v.id}")'>Detalhes</button>
   <a href="/tryit/apply/${v.id}" class="btn btn-success btn-sm">
    Candidatar-se
   </a>`
]),

    columns: [
      { title: "Título" },
      { title: "Cliente" },
      { title: "Local" },
      { title: "Tipo" },
      { title: "Ações", orderable: false }
    ],
    language: {
      url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/pt-BR.json'
    },
    pageLength: 25,
    responsive: true
  });

  // Filtros dinâmicos
  const locaisUnicos = [...new Set(data.map(v => v.local).filter(Boolean))];
  const tiposUnicos = [...new Set(data.map(v => v.tipo).filter(Boolean))];

  const locationFilter = document.getElementById("locationFilter");
  locaisUnicos.forEach(loc => {
    const opt = document.createElement("option");
    opt.value = loc;
    opt.textContent = loc;
    locationFilter.appendChild(opt);
  });

  const tipoFilter = document.getElementById("tipoFilter");
  tiposUnicos.forEach(tipo => {
    const opt = document.createElement("option");
    opt.value = tipo;
    opt.textContent = tipo;
    tipoFilter.appendChild(opt);
  });

  locationFilter.addEventListener("change", function () {
    table.column(2).search(this.value).draw();
  });

  tipoFilter.addEventListener("change", function () {
    table.column(3).search(this.value).draw();
  });
});

</script>
</body>
</html>